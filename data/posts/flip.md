### 개발기간: 2025.04.14 ~ 2025.05.21 (6주)

### 인원: 프론트 3, 백엔드 3 (프론트 리드)

## 개요

SSAFY에서의 마지막 팀 프로젝트를 감사하게도 삼성전자와 연계 팀에 선정되어 실제 현업자 분들과 소통하여 개발할 수 있었습니다.

삼성전자로 부터 받은 과제는 스마트 팩토리 물류 통합 관제 시스템 개발이었습니다.

> 스마트 팩토리란? 제조 공정 자동화를 통해 생산성을 향상시킨 공장입니다.

실제 현장에서 AMR, 즉 물류 운송을 담당하는 자율 주행 로봇들을 통합 관제하고 효율적으로 제어할 수 있는 시스템이 필요했습니다.

그래서 3가지의 목표를 잡았습니다.

1. 공장 내 물류 상황 파악
2. 여러 AMR을 한 화면에서 관리
3. 물류 작업을 효율적으로 배치

## 시뮬레이션 환경 구축

아쉽게도 실제 AMR을 이용하고 데이터를 받아올 수 없었기에, 시뮬레이션을 구축해야 했습니다.

### 공장 평면

현실과 유사한 환경을 위해 멘토님과 피드백을 거쳐 실제 공장에 가까운 도면을 직접 그렸습니다.

<img src="/flip/1.png" width="400" height="400" alt="공장 평면 지도" />

### 공장3d

평면 도면을 토대로 20개의 생산 라인이 작동하는 스마트폰 공장을 3d 모델링하였습니다.

<img src="/flip/Factory.gif" width="400" height="400" alt="공장 3D 지도" />

### AMR

블렌더를 활용하여 3가지 AMR 모델들을 만들었습니다.

<div style="display: flex; flex-wrap:wrap; gap: 4px;">
<img src="/flip/m1.gif" width="280" height="280" alt="m1" />
<img src="/flip/m2.gif" width="280" height="280" alt="m2" />
<img src="/flip/m3.gif" width="280" height="280" alt="m3" />
</div>

## 주요 기능

### 대시보드

6시간 동안의 시뮬레이션 데이터를 기반으로 AMR 운행 현황과 운행률, 생산현황 등 여러 정보를 수치로 한 눈에 파악할 수 있습니다. 신선한 데이터를 유지할 수 있게 5초마다 갱신됩니다.

오른쪽 아래 공장 지도에서는 실시간 상태를 보여주고, 스크롤이나 줌을 활용해서 에러 상황을 확인할 수 있습니다.

<img src="/flip/2.png" width="600" height="600" alt="dashboard" />

### 실시간 관제

만약 공장의 관리자라면 한 눈에 파악하고 싶지 않을까? 라고 생각하여 3D 디지털 트윈으로 공장을 구현하였습니다.

<img src="/flip/cctv.gif" width="600" height="600" alt="cctv" />

### 작업 재계산

미션을 완료했거나 에러가 발생한다면 즉시 모든 AMR의 경로를 재계산합니다.

<img src="/flip/route.gif" width="600" height="600" alt="route" />

### 히트맵

AMR 동선에 따라 자주 이용한 경로를 측정하여 히트맵 형식으로 볼 수 있습니다.  
공장 관리자는 히트맵을 통해 병목 현상이 어디서 발생할지 예측하고, 작업자들에게 주의해야하는 이동 동선을 교육할 수 있습니다.

<img src="/flip/heatmap.png" width="600" height="600" alt="heatmap" />

## 최적화

실시간 관제였던 만큼 데이터 통신이 잦아 데이터 변동이 많았습니다. 이에 UX 최적화에 기술적으로 많은 노력을 했습니다.

### 3D 모델 압축

3D 모델이 정교했던 만큼 파일의 크기가 커 불러오는 시간이 길었습니다.

그래서 화면에 안보이는 mesh들은 정리하고 여러 mesh들로 구성된 모델이나 공장들을 하나의 mesh로 묶어 blender 내에서의 최적화를 하였고 glTF와 draco를 사용하여 모델을 최적화하였습니다.

그 결과로 로딩 시간을 4.7초에서 2.6초로 약 45퍼센트 정도 줄일 수 있었습니다.

<img src="/flip/loading.gif" width="600" height="600" alt="loading" />

### 거리에 따른 렌더링

Top View에서 Orthographic Camera로 줌 레벨에 따른 렌더링 AMR 호기에 대한 렌더링을 제한했다.

<img src="/flip/2d_zoom.gif" width="400" height="400" alt="2d zoom" />

3D View에서는 Perspective Camera이기 때문에 카메라와의 거리를 계산하여 일정 거리보다 가까운 AMR들만 호기에 대한 렌더링을 해주었다.

<img src="/flip/3d_zoom.gif" width="400" height="400" alt="3d zoom" />

### 네트워크

Stomp와 Sockjs를 통해 서버와 실시간 연결을 하였습니다.

AMR 모델을 움직일 때 0.1초마다 AMR의 상태들을 받아와야 했습니다. 총 20개의 AMR을 운행했기에 데이터 양이 결코 적지 않았습니다. 그래서 데이터를 분기처리 하였습니다.

<img src="/flip/3.png" width="600" height="600" alt="control page" />

왼쪽 Panel 부분에서 필요한 정보와 오른쪽 View에서 필요한 정보가 각각 달랐습니다. 자주 변하지 않는 왼쪽 Panel은 1초마다 AMR의 미션 타입, 수행시간과 같은 데이터를 받아오고, 오른쪽 View는 0.1초마다 위치, 회전과 같이 부드러운 움직임을 위한 데이터를 받아왔습니다.

<img src="/flip/route.gif" width="600" height="600" alt="route" />

AMR을 클릭했을 때 경로를 받아오는 것도 실시간으로 이뤄져야 했습니다.

이렇게 많은 데이터를 불러오고 정리해야 했기 때문에 clean up이 굉장히 중요했습니다. 그래서 컴포넌트 마운트 시에 연결하고 언마운트 시에 cleanup 해줘서 네트워크 관리를 했습니다.

```jsx
useEffect(() => {
  // 구독
   subscriptionRef.current = amrSocket.subscribe(destination, (data) => {
	   ...
   })
	...
	// cleanup: 현재 구독 해제
	return () => {
		if(subscriptionRef.current) {
			subscriptionRef.current.unsubscribe();
			subscriptionRef.current = null
		}
	}
}
,[])
```

## Trouble Shooting

### 3D 이해

3D에 대한 이해도가 부족해서 View 컴포넌트를 만들 때 많은 문제들이 있었습니다.

기본적으로 공간에 대한 이해, 카메라 움직임, 맵 컨트롤 등 기존 웹 개발과 달랐습니다.

그래서 Three.js 강의 2개를 완강하며 배우면서 적용하여 3D에 대한 이해도를 올렸습니다.

<div style="display: flex; flex-wrap:wrap; gap: 4px;">
<img src="/flip/4.png" width="400" height="400" alt="수강인증1" />
<img src="/flip/5.png" width="400" height="400" alt="수강인증2" />
</div>

### 불필요한 렌더링

View 영역에서 1초 간격으로 생기는 끊김 현상이 있었습니다. 리액트 개발 툴을 통해 확인해보니 불필요한 렌더링이 이뤄졌습니다. 이를테면 Filter나 Tab같이 변하지 않아도 되는 컴포넌트들이 리렌더링이 발생하여 분리했고 10ms 정도 성과는 있었지만, 근본적인 문제가 아니었습니다.

왼쪽 Panel 부분에서 1초마다 받아오는 값이 오른쪽 View에도 영향을 미쳐 찾아보니 AMR 선택 시에 Panel에서 1초마다 출발지와 목적지를 바꿔줬는데 이게 View 렌더링에도 영향을 미쳐 끊김 현상이 나타났습니다. 그래서 변경시에만 렌더링 되도록 수정하였습니다.

## 피드백

> 기존에는 어떤 방식으로 작업 배치나 관제가 이루어지고 있었는지, 추후 저희 프로젝트가 어떻게 활용될 수 있을지 의견 주실 수 있을까요?

위의 질문에 멘토님은 아래와 같은 답변을 해주셨다.

### 1. 작업 배치 시스템 개선

**기존 시스템**

- 작업이 발생하면 가까운 AMR(자율주행로봇) 중에서만 선택
- 한번 할당된 작업은 변경 불가
- 전체 AMR을 고려하지 않은 제한적인 배치

**개선 방향**

- 전체 AMR을 대상으로 한 최적 작업 배치
- 상황 변화에 따른 작업 재할당 기능 추가

### 2. 경로 탐색 시스템 개선

**기존 시스템**

- A\* 알고리즘만 사용
- 경로 재탐색 기능 없음

**개선 방향**

- 실시간 경로 갱신 기능 추가
- AI 기반 경로 탐색 도입

### 3. 실시간 관제 시스템 개선

**기존 시스템**

- 기본적인 미션 할당 시간만 확인 가능
- AMR 상태와 미션 종류 확인 가능 (필터링 없음)
- 이동 빈도 시각화 기능 없음

**개선 방향**

- 예상/실제 수행 시간 모니터링
- 미션 타입별, 상태별 필터링 기능
- 이동 빈도 시각화를 통한 교통 정체 구역 파악

### 4. 최적 작업 배치 시스템 개선

**기존 시스템**

- A\* 알고리즘 기반 단순 경로 최적화
- 특정 상황(장애물 등)에서만 경로 재탐색
- 할당된 미션 변경 불가

**개선 방향**

- DQN(Deep Q-Network) 기반 A\* 알고리즘 적용
- 실시간 최적 경로 재탐색
- 상황에 따른 유연한 미션 재할당
- 자재 적재 상태가 아닌 경우, 가까운 AMR에 미션 재할당
- Tact time(작업 시간)과 Cycle time(전체 소요 시간) 단축

실제로 현업에서 조만간 과제화해서 기존 성능 향상을 계획했던 포인트들을 우리 프로젝트에서 어느정도 성과를 낼 수 있었다.

## 기술 스택

`Next.js` : React 기반의 프레임워크, 서버 사이드 렌더링(SSR)을 활용하여 성능 최적화.

`TypeScript` : 코드의 안정성 및 유지 보수성을 높이는 강력한 타입 시스템 제공

`React-Three-fiber 및 drei` : three js를 React 생태계에서 재사용 가능하고 독립적인 구성 요소를 사용하여 선언적으로 개발할 수 있는 라이브러리.

`React-query` : 서버 상태 관리를 위한 라이브러리로, 데이터 페칭, 캐싱, 동기화, 업데이트를 간편하고 효율적으로 처리. 대시보드와 같은 서버 상태 api에 활용

`Zustand` : 간단하고 가벼운 클라이언트 상태 관리 라이브러리로, 실시간 데이터의 복잡한 상태를 관리.

`TailwindCSS` : 유틸리티 클래스 기반 CSS 프레임워크로, 빠르고 일관된 UI 개발에 활용.

`Shadcn` : 전체 라이브러리를 종속성으로 설치하는 대신 필요한 컴포넌트만 선택적으로 프로젝트에 직접 커스터마이징 및 적용에 활용

`MSW` : HTTP 요청을 가로챈 후 Mocking된 응답 값을 반환함으로써 백엔드가 서버를 배포하기 전부터 api 함수 생성하여 빠른 개발에 활용

## 성과

- 먼저 현업자 분들과 소통하며 **소통 스킬**에 대해 느낄 수 있었습니다. 저희 팀의 날 것(?)의 질문들을 일목요연하게 "질문의 요점이 무엇이고 이것에 대한 답변은 이렇다." 이러한 소통 스킬을 배울 수 있었고 프론트엔드 개발자이신 멘토님의 조언 덕분에 화면의 디테일한 점들을 살릴 수 있었습니다.
- 프론트 리드로서 기술 선정부터 **데이터 흐름도 및 최적화 설계**
- 3D에 대한 이해도와 복잡한 실시간 데이터 처리 등 **개발 역량 향상**
- 이전 프로젝트부터 FSD 구조를 사용하면서 이해도가 증가하여 **유지보수 효율 상승**
- 기업 연계를 진행한 총 11팀 중에서 본선에 진출하여 **우수상**

## 느낀점

6주간 너무 즐겁게 개발했습니다. 현업자 멘토님들의 피드백을 들어 수정하며 완성도 있는 프로젝트를 만든 것에 뿌듯한 마음도 있습니다. 특히 사용해보고 싶었던 기술인 Three.js를 배우고 적용하며 뜻깊은 경험이 되었고, 추후 블로그에도 3D 적용하고 싶다는 생각이 들었습니다.

## 링크

- [WebSite (~06.03)](https://samsung-smartfactory.co.kr/)
- [Github](https://github.com/Steadystudy/SmartFactory)
- [Canva](https://www.canva.com/design/DAGoOm97R8c/2n4Lj3Hc8n7BYPg0ghJlYg/edit)
